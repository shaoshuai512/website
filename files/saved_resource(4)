M.add("mt-xsstorage",function(e){var t,n,o,a=e.mt.cookie,r=e.Lang,i=M&&M.Env["data-conf"]||{},c="http://"+(i.rootHost||"www.meituan.com"),u=M&&M.DOMAIN_HOST||"meituan.com",l="/xsstorage.html",m=function(){var e="teststorage",t="http:"===window.location.protocol;if(!window.JSON||!window.postMessage||!t)return!1;try{localStorage.setItem(e,e);var n=localStorage.getItem(e);return localStorage.removeItem(e),n===e}catch(o){return!1}}(),s=function(){if(t)return t;var n="_ls_";return t={getItem:function(e,t,o){e=n+e;var r=a.get(e);return o=o||null,t&&t.call(o,r),r},getAndRemove:function(e,n,o){var a=t.getItem(e,n,o);return localStorage.removeItem(e),a},setItem:function(t,o){t=n+t,r.isObject(o)&&(o=e.JSON.stringify(o)),a.set(t,o,a.getExpiresDate(30,0,0),"/",u)},removeItem:function(e){e=n+e,a.remove(e,"/",u)},appendItem:function(e,t){e=n+e;var o=a.get(e);a.set(e,o+t,a.getExpiresDate(30,0,0),"/",u)}}},g=function(){if(n)return n;var t=["setItem","removeItem","clear"];return n={getItem:function(e,t,n){var o=localStorage.getItem(e);return n=n||null,t&&t.call(n,o),o},getAndRemove:function(e,t,o){var a=n.getItem(e,t,o);return localStorage.removeItem(e),a},appendItem:function(e,t){var n=localStorage.getItem(e)||"";localStorage.setItem(e,n+t)}},e.Array.each(t,function(e){n[e]=function(){localStorage[e].apply(localStorage,arguments)}}),n},f=function(){if(o)return o;var t=e.Node.create('<iframe width="1" height="1" frameborder="0" style="position:absolute;top:0;left:-9999px;"></iframe>'),n={},a=0,r=[],i=!1;return o={getItem:function(e,t,n){o._apihub("getItem",{key:e,callback:t,context:n})},getAndRemove:function(e,t,n){o._apihub("getAndRemove",{key:e,callback:t,context:n})},setItem:function(e,t){o._apihub("setItem",{key:e,val:t})},appendItem:function(e,t){o._apihub("appendItem",{key:e,val:t})},removeItem:function(e){o._apihub("removeItem",{key:e})},clear:function(){o._apihub("clear")},_apihub:function(e,t){var c,u,l=t.callback,m={method:e,args:{key:t.key,value:t.val}};return l&&(c=a++,u=t.context||null,n[c]={cb:l,ctx:u},m.args.rid=c),i?void o._sendRequest(m):void r.push(m)},_sendRequest:function(n){var o=e.Node.getDOMNode(t);o.contentWindow.postMessage(e.JSON.stringify(n),c)},_handleMsg:function(t){if(t){var o,a=t.rid;!e.Lang.isUndefined(a)&&(o=n[a])&&(o.cb.call(o.ctx,t.value),delete n[a])}}},t.set("src",c+l),e.one("body").append(t),t.on("load",function(){i=!0,e.Array.each(r,o._sendRequest)}),e.one(window).on("message",function(e){if(e._event.origin===c){var t=JSON.parse(e._event.data);o._handleMsg(t)}}),o};e.namespace("mt.XSStorage"),e.mt.XSStorage={isSupportXSStorage:m,getInstance:function(e){e=e||{};var t=!!e.forceAsync,n=!!e.useCookie;return m?location.origin!==c||t?f():g():n?s():!1}}},"1.0.0",{requires:["mt-base"]});
M.add("mt-beacon",function(a){function o(){for(var a,o=v.mbq,n=o._q,t=0;t!==n.length;)a=n[t],o.apply(null,a)?n.splice(t,1):t++}function n(){return!a.UA.ie&&f.isSupportXSStorage}var t,e=a.config["mt-beacon"]||{},r=1,i=2,c=3,l=5,g=4,s=a.getLocation(),f=a.mt.XSStorage,m="FORCHROME",u="eventlist",b=n(),d=YUI.Env.beacon=YUI.Env.beacon||{},p=e.mbq||"_mbq",y=e.mbqCtx||window,v={mbq:null,addBeaconMethods:function(n,t){a.Object.each(n,function(o,n){t&&(o=a.bind(o,t)),v[n]=o}),o()},blog:function(o){var n={};o&&a.mix(n,o),e.blog&&e.blog.data&&a.mix(n,"function"==typeof e.blog.data?e.blog.data():e.blog.data),n.url||(n.url=s.pathname),n.domain||(n.domain=s.host),this.beacon(n,i)},asynclog:function(o){if(o){var n={};a.mix(n,o),e.asynclog&&e.asynclog.data&&a.mix(n,"function"==typeof e.asynclog.data?e.asynclog.data():e.asynclog.data),n.url||(n.url=s.pathname),n.domain||(n.domain=s.host),this.beacon(n,g)}},eventlog:function(o,n,t,e){var r={ca:o,ac:n,la:t};e&&a.mix(r,e),r.url=r.url||s.href,this.beacon(r,c)},localEventlog:function(o,n,t,e){var r={ca:o,ac:n,la:t};e&&a.mix(r,e),r.url=r.url||s.href,this.beacon(r,l)},errorlog:function(o,n,t){var i={type:"jsdebug",level:o||"fatal",msg:n};t&&a.mix(i,t),e.errorlog&&e.errorlog.data&&a.mix(i,"function"==typeof e.errorlog.data?e.errorlog.data():e.errorlog.data),this.beacon(i,r)},beacon:function(o,n){var p,y=e.domainHost||s.hostname,v=e.cdnDomainHost||s.hostname,h=a.Lang.now(),q=d[h]=new Image,x=s.protocol;switch(e.data&&a.mix(o,"function"==typeof e.data?e.data():e.data),o.time||(o.time=a.Lang.now()),!o.r&&a.config.doc.referrer&&(o.r=a.config.doc.referrer),n){case r:p="https:"===x?x+"//felog."+y+"/_.gif":x+"//fe."+v+"/_.gif";break;case i:p=x+"//b."+y+"/_.gif";break;case c:p=x+"//b."+y+"/_mt.gif";break;case l:if(p=x+"//b."+y+"/_mt.gif",b){var _=p+"?"+a.QueryString.stringify(o);return t=f.getInstance(),void t.appendItem(u,m+_)}break;case g:p=x+"//b."+y+"/_async.gif"}p&&(q.src=p+"?"+a.QueryString.stringify(o))}};a.namespace("mt.beacon"),a.mt.beacon=v,function(){var o,n=p,t=y;o=t[n]&&t[n]._q||[],t[n]=v.mbq=function(){var o=arguments[0];return o=v.hasOwnProperty(o)&&v[o],a.Lang.isFunction(o)?(o.apply(v,Array.prototype.slice.call(arguments,1)),!0):!1},t[n]._q=o,v.addBeaconMethods({blog:v.blog,eventlog:v.eventlog,localEventlog:v.localEventlog,asynclog:v.asynclog,errorlog:v.errorlog},v)}(),b&&(t=f.getInstance(),t.getAndRemove(u,function(a){var o,n,t;if(a)for(a=a.split(m),a.shift(),o=0;n=a.pop();o++)t=d[o]=new Image,t.src=n}))},"1.0.0",{requires:["querystring-stringify-simple","mt-base","mt-xsstorage"]});
M.add("mt-log",function(e){function n(){function n(){var e=a.timing;if(e){var n,t=[],r=Number.POSITIVE_INFINITY,d=o;for(n=0;n<d.length;n++)e[d[n]]?(t[n]=e[d[n]],t[n]<r&&(r=t[n])):t[n]=-1;for(n=0;n<d.length;n++)t[n]>0&&(t[n]-=r);i.pt_start=r,i.pt_index=t.join(",")}}function t(){var e=a.navigation;e&&(i.pn_redirect=e.redirectCount,i.pn_type=e.type)}var o=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"],i={},a=e.config.win.performance;return a?(n(),t(),i):{}}function t(n){var t,o;if(o=d._modules=d._modules||[],n&&o.push(n),d._isblogdone){for(t=o.length-1;t>=0;t--)a("asynclog",e.mix(o[t],d.pageviewData));d._modules=[]}}var o=e.config["mt-log"]||{},i=e.mt.beacon,a=i.mbq,r=function(){var n="",t="",i=0,r=10,d=null,c=500;return function(u,f,g){if(!o.error||!o.error.disable)if(u!==n||f!==t)e.config.win.setTimeout(function(){a("errorlog",u,f,g)},c),n=u,t=f,i=0;else{if(d||i++>=r)return;d=e.config.win.setTimeout(function(){a("errorlog",u,f,g),d=null},c)}}}(),d={pageview:function(i){function r(){e.config.win._gat&&e.config.win._gat._getTracker?d():v>g?d(l):(e.config.win.setTimeout(function(){r()},f),v+=f)}function d(e){w||(c.pageviewData.expire=e||0,a("blog",c.pageviewData),w=!0,c._isblogdone=!0,t())}var c=this,u=200,f=100,g=15e3,l=1,m=2,v=0,w=!1;e.config.win.setTimeout(function(){i=i||{};var t={};e.mix(t,i.extra),e.mix(t,n()),o.pageview&&o.pageview.data&&e.mix(t,"function"==typeof o.pageview.data?o.pageview.data():o.pageview.data),c.pageviewData=t,i.hasGA===!1?d():r(),e.one(e.config.win).on("beforeunload",function(){d(m)})},u)},moduleview:function(n){if(n&&n.pm){var i={};e.mix(i,n),o.moduleview&&o.moduleview.data&&e.mix(i,"function"==typeof o.moduleview.data?o.moduleview.data():o.moduleview.data),t(i)}},error:r};e.namespace("mt.log"),e.mt.log=d,i.addBeaconMethods({trackPageview:d.pageview,trackModuleview:d.moduleview,logJsError:d.error},d),e.config.debug||(e.config.win.onerror=function(n,t,o){return d.error("fatal",n,{src:"window",url:t||e.getLocation().href,line:o}),!0})},"1.0.0",{requires:["node","mt-beacon"]});
M.add("mt-tracker",function(Y){function decodeAttr(nd,attr){var str=nd.getAttribute(attr);if(!str)return null;try{return eval("("+str+")")}catch(ex){return null}}var MT_EVENT="mtevent",GA_EVENT="gaevent",MT_MODULE="mod",MT_MODULE_EXTRA="mod-extra",D_MT_EVENT="data-"+MT_EVENT,D_MT_MODULE="data-"+MT_MODULE,_mbq=Y.mt.beacon.mbq;Y.namespace("mt.tracker"),Y.mt.tracker={init:function(){var t={mtevent:this.trackMTEvent,gaevent:this.trackGACustomEvent,gaexternal:this.trackGAExternalLink,mtmodule:this.trackMTModule};Y.Array.each(arguments,function(e){t[e]()})},trackMTModule:function(){var t=Y.one("body"),e="UserAction",a="Click",n="module/click";t.delegate("click",function(t){var r=t.target;if(r.hasClass("data-mod-enabled")||"a"===r.get("tagName").toLowerCase()||r.ancestor("a")){var c={pm:this.getAttribute(D_MT_MODULE)},i=r.ancestor("a",!0),o=i&&i.getData(MT_MODULE_EXTRA);o&&(o=Y.JSON.parse(o),c=Y.mix(c,o)),_mbq("localEventlog",e,a,n,c)}},"["+D_MT_MODULE+"]")},trackMTEvent:function(){var t=Y.one(document.body),e="data-mteventnd";t.delegate("click",function(){var t,a,n,r=decodeAttr(this,D_MT_EVENT),c={};r&&(this.ancestors("["+e+"]").each(function(t){Y.mix(c,decodeAttr(t,e),!0)}),"undefined"==typeof c.ca&&(c.ca="InnerLink"),"undefined"==typeof c.ac&&(c.ac="Click"),Y.mix(r,c),t=r.ca,a=r.ac,n=r.la,delete r.ca,delete r.ac,delete r.la,_mbq("localEventlog",t,a,n,r))},"[data-"+MT_EVENT+"]")},trackGACustomEvent:function(){var t=Y.one(document.body),e=GA_EVENT;t.delegate("click",function(){var t=this.getAttribute(e);if(t){var a=t.split("|");a.length<3&&a.unshift("InnerLink","Click"),!a[2]&&this.get("href")&&(a[2]=this.get("href").replace("http://","")),_gaq&&_gaq.push(["_trackEvent"].concat(a))}},"["+e+"]")},trackGAExternalLink:function(){var t=Y.one(document.body);t.delegate("click",function(){var t,e,a=this.get("href"),n=/^(http:\/\/|mailto:)/;if(a&&n.test(a)){if(a=a.replace("http://",""),t=a.indexOf("?"),e=this.getAttribute("galabel"),t>0&&(a=a.substring(0,t)),/\.(meituan|mt|sankuai)\.com/.test(a))return;e&&(a+="#label="+e),_gaq&&_gaq.push(["_trackEvent","OutLink","Click",a])}},"a")}}},"1.0.0",{requires:["node","event","mt-beacon"]});